==========================
ğŸ“„ MTA.YAML DOCUMENTATION
Project: invoicing-capm
Version: 1.0.0
Description: CAP + React Fullstack App
==========================

ğŸ§© Purpose:
This MTA (Multi-Target Application) deployment file orchestrates the build, deployment, and binding of a full-stack application composed of:
- Backend (CAP Node.js Service)
- Frontend (React)
- Approuter
- HTML5 App Repository Deployment
- Connectivity to S/4HANA Cloud via destination
- Security via XSUAA

--------------------------
ğŸ”§ GLOBAL PARAMETERS
--------------------------

- _schema-version: "3.3"
- enable-parallel-deployments: true â†’ Allows parallel module deployment for faster builds.

--------------------------
ğŸ“¦ MODULES
--------------------------

1ï¸âƒ£ MODULE: backend-srv-inv
-----------------------------
Type: nodejs
Path: `backend`

âœ” Handles CAPM CDS service logic.
âœ” Uses Node.js buildpack.
âœ” Builds using:
  - `npm install --omit=dev`
  - `cds build --production`

ğŸ”— Requires:
- `destination-backend`: for outbound HTTP calls.
- `html5-apps-repo-runtime`: in case UI accesses backend.
- `xsuaa-invoicing-capm-clean`: for XSUAA integration.

Provides: 
- `srv-api-inv` â†’ exposes `srv-url` used by approuter.

Environment:
- API_USER / API_PASS â†’ used for backend API auth logic.

2ï¸âƒ£ MODULE: frontend
-----------------------------
Type: html5
Path: `app/build`

âœ” Contains compiled output of the React frontend.
âœ” Build commands:
  - `npm install`
  - `npm run build`
âœ” Uploaded to HTML5 App Repository.
âœ” No supported platforms specified (custom frontend).

ğŸ”— Requires:
- `html5-apps-repo-host`: HTML5 repo for app deployment.

3ï¸âƒ£ MODULE: frontend-deployer
-----------------------------
Type: com.sap.application.content
Path: `app/frontend-deployer`

âœ” Deploys frontend artifacts into HTML5 Apps Repository.
âœ” Points to build output using `build-result: resources`.
âœ” References the `frontend` moduleâ€™s build artifacts.

4ï¸âƒ£ MODULE: approuter
-----------------------------
Type: nodejs
Path: `approuter`

âœ” Routes users to the React app via `/`, backend APIs via `/rest` or `/odata`.
âœ” Keeps existing routes on update.
âœ” Requires:

  - `html5-apps-repo-runtime`: runtime access to deployed UI5/React apps.
  - `html5-apps-repo-host`: to serve content from HTML5 repo.
  - `destination-backend`: for destination config.
  - `xsuaa-invoicing-capm-clean`: for authentication.
  - `srv-api-inv`: exposes CAPM backend via destination binding.

âœ” Destinations:
  - Name: `srv-api-inv`
  - URL: dynamic â†’ `~{srv-url}`
  - `forwardAuthToken: true` â†’ required to forward JWT tokens securely.

--------------------------
ğŸ”Œ RESOURCES
--------------------------

1ï¸âƒ£ destination-backend
-----------------------------
âœ” CF managed service for destinations (lite plan)
âœ” Used to configure destinations to backend (and optionally, S/4HANA).

2ï¸âƒ£ html5-apps-repo-runtime
-----------------------------
âœ” Provides runtime access to HTML5 (UI5/React) apps for Approuter.

3ï¸âƒ£ html5-apps-repo-host
-----------------------------
âœ” Hosts UI artifacts like React or SAPUI5 in BTP HTML5 App Repository.

4ï¸âƒ£ s4hana-destination
-----------------------------
âœ” Destination to S/4HANA Cloud (external system).
âœ” Type: HTTP, ProxyType: Internet, BasicAuthentication
âœ” Used by backend to call APIs (like BillingDocument API).

â„¹ï¸ Config:
- User/Password are hardcoded for demo/testing.
- Can be improved using environment variables or secrets manager.

5ï¸âƒ£ xsuaa-invoicing-capm-clean
-----------------------------
âœ” Security configuration using XSUAA (Application Plan).
âœ” Authenticates users via OAuth2.
âœ” Used for:
  - Approuter login
  - Forwarding tokens to backend
  - HTML5 app authorization

âœ” config-path: `./xs-security.json`
âœ” Custom xsappname and redirect URI configured for subaccount.

--------------------------
âœ… BUILD FLOW
--------------------------

1. Pre-build steps run `npm install` and `cds build` for backend.
2. `frontend` module builds React output into `build/`.
3. `frontend-deployer` packages it and deploys to HTML5 repo.
4. `approuter` is deployed to route users to the UI and backend APIs.
5. Destinations and services are bound appropriately.

--------------------------
ğŸ“ NOTES
--------------------------

- FLP (Fiori Launchpad) Integration:
  - `manifest.json` under `app/public` should define `sap.app.crossNavigation` to register app tile.
  - Ensure `xs-app.json` under `app/` routes `/invoicing-capm-reactapp/` correctly.
  - React frontend gets served through Approuter â†’ FLP Tile â†’ HTML5 Repo.

- Deploy with:
  mbt build -p cf
  cf deploy mta_archives/invoicing-capm_1.0.0.mtar

==========================
End of Documentation
==========================
